<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.scihi.mbgl.mapper.MbglInfoMapper">
	<sql id="Base_Column_List">
		t.id
		,t.sys_id
		,t.pid
		,t.pdid
		,t.status
		,t.remark
		,t.creator
		,t.created
		,t.modifier
		,t.modified
		,t.ext1
		,t.ext2
		,t.ext3
		,t.row_version
		,t.row_state
		,t.row_default
		,t.row_hist
	</sql>
	<select id="select" parameterType="HashMap" resultType="MyMap">
		select
		<include refid="Base_Column_List" />
		,t.glid
		,t.xh
		,t.zxxm
		,t.zysx
		,t.zxr
		,t.zxsj
		,t.cycle, t.cycle_count, t.repeat_
		,t1.user_alias as "modifierDesc"
		,t.task_req, t.req_id, t.req_model_id
		from s_mbgl_info t
		left join sys_user t1 on t.modifier = t1.user_name
		<where>
			<if test="null != id and '' != id">
				t.id = #{id}
			</if>
			<if test="null != sys_id and '' != sys_id">
				and t.sys_id = #{sys_id}
			</if>
			<if test="null != pid and '' != pid">
				and t.pid = #{pid}
			</if>
			<if test="null != status and '' != status">
				and t.status = #{status}
			</if>
			<if test="null != glid and '' != glid">
				and t.glid = #{glid}
			</if>
			<if test="null != ext1 and '' != ext1">
				and t.ext1 = #{ext1}
			</if>
			<if test="null != ext2 and '' != ext2">
				and t.ext2 = #{ext2}
			</if>
			<if test="null != keywords and '' != keywords">
				and (t.pid like '${keywords}%'
				or t.zxxm like '${keywords}%'
				or t.zysx like '${keywords}%'
				or t1.user_alias like '${keywords}%'
				)
			</if>
		</where>
		group by t.id
		order by t.xh+0
	</select>
	<delete id="delete" parameterType="HashMap">
		delete from s_mbgl_info
		where
		<choose>
			<when test="glid!=null">
				glid in
				<foreach collection="glid.split(',')" open="(" separator="," close=")" item="item" index="index">
					#{item}
				</foreach>
			</when>
			<when test="id!=null">
				or id in
				<foreach collection="id.split(',')" open="(" separator="," close=")" item="item" index="index">
					#{item}
				</foreach>
			</when>
			<otherwise>1=2</otherwise>
		</choose>
	</delete>
	<insert id="insert" parameterType="HashMap" useGeneratedKeys="true" keyProperty="id">
		insert into s_mbgl_info (
		<include refid="BaseMapper.Base_Column_List_Insert" />
		,glid
		,xh
		,zxxm
		,zysx
		,zxr
		,cycle
		,cycle_count
		,repeat_
		,task_req, req_id, req_model_id
		)
		values(
		<include refid="BaseMapper.Base_Column_List_Insert_Values" />
		,#{glid}
		,#{xh}
		,#{zxxm}
		,#{zysx}
		,#{zxr}
		,#{cycle}
		,1
		,#{repeat_}
		,#{zysx}, #{req_id}, #{req_model_id}
		)
	</insert>
	<update id="update" parameterType="HashMap">
		update s_mbgl_info
		set
		glid =
		#{glid}
		,xh = #{xh}
		,zxxm = #{zxxm}
		,zysx = #{zysx}
		,zxr = #{zxr}
		,zxsj =
		#{zxsj}

		,pid = #{pid}
		,pdid = #{pdid}
		,status = #{status}
		,remark = #{remark}
		,modifier = #{modifier}
		,modified = #{modified}
		,ext1 = #{ext1}
		,ext2 =
		#{ext2}
		,ext3 = #{ext3}
		,row_version = #{row_version}
		,row_state =
		#{row_state}
		,row_default = #{row_default}
		,row_hist = #{row_hist}
		where
		id = #{id}
	</update>

	<update id="softDelete" parameterType="HashMap">
		update s_mbgl
		set
		status = '0'
		where id in
		<foreach collection="id.split(',')" open="(" separator=","
			close=")" item="item" index="index">
			#{item}
		</foreach>;
		update s_mbgl_info
		set status = '0'
		where glid in
		<foreach collection="id.split(',')" open="(" separator=","
			close=")" item="item" index="index">
			#{item}
		</foreach>
	</update>

	<update id="updateRowHist" parameterType="HashMap">
		update s_mbgl_info
		set
		status = #{status}
		,row_hist = #{row_hist_new}
		where
		id = #{row_hist_old}
		or row_hist = #{row_hist_old}
	</update>

	<update id="updateForCondition">
		update s_mbgl_info set modifier=now()
		<if test="updateMap.status!=null">, status=#{updateMap.status}</if>
		where 1=1
		<if test="conditionMap.id!=null">and id=#{conditionMap.id}</if>
		<if test="conditionMap.glid!=null">and glid=#{conditionMap.glid}</if>
	</update>
</mapper>